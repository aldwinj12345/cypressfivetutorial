name: Cypress Tests

on: 
    push:
    workflow_dispatch:

jobs:
  cypress-run:
            runs-on: ubuntu-latest
            strategy:
              fail-fast: false
              matrix:
                browsers: [chrome, firefox, edge]
            steps:
              - name: Checkout
                uses: actions/checkout@v4
              - name: Cypress run in ${{ matrix.browsers }}
                uses: cypress-io/github-action@v6
                with:
                  browser: ${{ matrix.browsers }}
                  command: npx cypress run --browser ${{ matrix.browsers }} --reporter-options reportDir=cypress/reports/${{ matrix.browsers }}
              - name: Wait for Reports
                run: sleep 5 # Wait 5 seconds to ensure reports are written
              - name: Upload Raw Mochawesome Reports
                uses: actions/upload-artifact@v4
                with:
                  name: mochawesome-raw-reports-${{ matrix.browsers }}
                  path: cypress/reports/${{ matrix.browsers }}/*.json
